/******************************
 * dotmatrix.c
 * 
 * MAX7219 - 8x8 dotmatrix using SPI
 * 		DIN	12	(BCM_GPIO 10)
 * 		CS	10	(BCM_GPIO 8)
 * 		CLK	14	(BCM_GPIO 11)
 * 
 ******************************/

#include "dotmatrix.h"


//////////////////////////////////////////////////
// Variable

// Number - 01 ~ 16
unsigned char num_array[18][8] = {
  { 0x00,0xee,0xaa,0xaa,0xaa,0xee,0x00,0x00 }, // 00
  { 0x00,0xe2,0xa2,0xa2,0xa2,0xe2,0x00,0x00 }, // 01
  { 0x00,0xee,0xa2,0xae,0xa8,0xee,0x00,0x00 }, // 02
  { 0x00,0xee,0xa2,0xae,0xa2,0xee,0x00,0x00 }, // 03
  { 0x00,0xea,0xaa,0xae,0xa2,0xe2,0x00,0x00 }, // 04
  { 0x00,0xee,0xa8,0xae,0xa2,0xee,0x00,0x00 }, // 05
  { 0x00,0xee,0xa8,0xae,0xaa,0xee,0x00,0x00 }, // 06
  { 0x00,0xee,0xa2,0xa2,0xa2,0xe2,0x00,0x00 }, // 07
  { 0x00,0xee,0xaa,0xae,0xaa,0xee,0x00,0x00 }, // 08
  { 0x00,0xee,0xaa,0xae,0xa2,0xee,0x00,0x00 }, // 09
  { 0x00,0x2e,0x2a,0x2a,0x2a,0x2e,0x00,0x00 }, // 10
  { 0x00,0x22,0x22,0x22,0x22,0x22,0x00,0x00 }, // 11
  { 0x00,0x2e,0x22,0x2e,0x28,0x2e,0x00,0x00 }, // 12
  { 0x00,0x2e,0x22,0x2e,0x22,0x2e,0x00,0x00 }, // 13
  { 0x00,0x2a,0x2a,0x2e,0x22,0x22,0x00,0x00 }, // 14
  { 0x00,0x2e,0x28,0x2e,0x22,0x2e,0x00,0x00 }, // 15
  { 0x00,0x2e,0x28,0x2e,0x2a,0x2e,0x00,0x00 }, // 16
  { 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00 }, // space
};


// Area - S1 ~ S16
unsigned char area_array[18][8] = {
  { 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00 }, // S0
  { 0xc0,0xc0,0x00,0x00,0x00,0x00,0x00,0x00 }, // S1
  { 0x30,0x30,0x00,0x00,0x00,0x00,0x00,0x00 }, // S2
  { 0x0c,0x0c,0x00,0x00,0x00,0x00,0x00,0x00 }, // S3
  { 0x03,0x03,0x00,0x00,0x00,0x00,0x00,0x00 }, // S4
  { 0x00,0x00,0xc0,0xc0,0x00,0x00,0x00,0x00 }, // S5
  { 0x00,0x00,0x30,0x30,0x00,0x00,0x00,0x00 }, // S6
  { 0x00,0x00,0x0c,0x0c,0x00,0x00,0x00,0x00 }, // S7
  { 0x00,0x00,0x03,0x03,0x00,0x00,0x00,0x00 }, // S8
  { 0x00,0x00,0x00,0x00,0xc0,0xc0,0x00,0x00 }, // S9
  { 0x00,0x00,0x00,0x00,0x30,0x30,0x00,0x00 }, // S10
  { 0x00,0x00,0x00,0x00,0x0c,0x0c,0x00,0x00 }, // S11
  { 0x00,0x00,0x00,0x00,0x03,0x03,0x00,0x00 }, // S12
  { 0x00,0x00,0x00,0x00,0x00,0x00,0xc0,0xc0 }, // S13
  { 0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x30 }, // S14
  { 0x00,0x00,0x00,0x00,0x00,0x00,0x0c,0x0c }, // S15
  { 0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x03 }, // S16
  { 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00 }, // space
};


//////////////////////////////////////////////////
// Function Definition

void Delay_xms(unsigned int x) {
	bcm2835_delay(x);
}


void Write_Max7219_byte(unsigned char data) {
	bcm2835_gpio_write(Max7219_pinCS, LOW);
	bcm2835_spi_transfer(data);
}


void Write_Max7219(unsigned char address, unsigned char data) {
	bcm2835_gpio_write(Max7219_pinCS, LOW);
	Write_Max7219_byte(address);
	Write_Max7219_byte(data);
	bcm2835_gpio_write(Max7219_pinCS, HIGH);
}


void Init_MAX7219() {
	Write_Max7219(0x09, 0x00);
	Write_Max7219(0x0A, 0x03);
	Write_Max7219(0x0B, 0x07);
	Write_Max7219(0x0C, 0x01);
	Write_Max7219(0x0F, 0x00);
}


void dot_num_print(int num) {
	int i;
	for(i = 1; i < 9; i++) {
		Write_Max7219(i, num_array[num][i-1]);
	}
}


void dot_area_print(int area) {
	int i;
	for(i = 1; i < 9; i++) {
		Write_Max7219(i, area_array[area][i-1]);
	}
}

